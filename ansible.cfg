# ansible.cfg
# Configuration Ansible pour SHA Application Environment Builder
# Optimisé pour l'exécution via AAP2 avec intégration SHA-Toolbox
[defaults]

# Inventaire et rôles
inventory = inventories/
roles_path = roles:roles_requirements
collections_path = collections
library = roles/ips_toolbox_modules/library:/usr/share/ansible/plugins/modules
module_utils = roles/ips_toolbox_modules/module_utils:/usr/share/ansible/plugins/module_utils

# Comportement général
host_key_checking = False
timeout = 30
forks = 5
poll_interval = 2
gathering = smart
fact_caching = memory
fact_caching_timeout = 3600

# Logs et debugging
log_path = /tmp/ansible.log
display_skipped_hosts = True
display_ok_hosts = True
display_failed_stderr = True

# Performance et retry
retry_files_enabled = True
retry_files_save_path = /tmp/ansible-retry
stdout_callback = yaml
bin_ansible_callbacks = True

# Variables et templating
hash_behaviour = merge
jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n
ansible_managed = "Fichier géré par Ansible SHA-Toolbox - {file} modifié le %Y-%m-%d %H:%M:%S par {uid} sur {host}"

# Sécurité et élévation de privilèges
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# Modules et plugins
action_plugins = roles/ips_toolbox_modules/action_plugins:/usr/share/ansible/plugins/action
callback_plugins = roles/ips_toolbox_modules/callback_plugins:/usr/share/ansible/plugins/callback
connection_plugins = roles/ips_toolbox_modules/connection_plugins:/usr/share/ansible/plugins/connection
filter_plugins = roles/ips_toolbox_modules/filter_plugins:/usr/share/ansible/plugins/filter
lookup_plugins = roles/ips_toolbox_modules/lookup_plugins:/usr/share/ansible/plugins/lookup
vars_plugins = roles/ips_toolbox_modules/vars_plugins:/usr/share/ansible/plugins/vars

# Gestion des erreurs et stratégies
error_on_undefined_vars = False
force_valid_group_names = ignore
any_errors_fatal = False
max_fail_percentage = 0

# SSH et connexions
transport = ssh
ssh_args = -C -o ControlMaster=auto -o ControlPersist=300s -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
ssh_executable = /usr/bin/ssh
scp_if_ssh = smart
sftp_batch_mode = False
control_path_dir = /tmp/.ansible-cp

# Windows et WinRM
[winrm_connection]
# Délai d'attente pour les connexions WinRM (Windows)
connection_timeout = 60
read_timeout = 300
operation_timeout = 240

[ssh_connection]
# Configuration SSH pour Unix/Linux
ssh_args = -C -o ControlMaster=auto -o ControlPersist=300s -o ServerAliveInterval=30 -o ServerAliveCountMax=3 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
control_path = /tmp/.ansible-cp/cp%%h-%%p-%%r
control_path_dir = /tmp/.ansible-cp
pipelining = True
retries = 3

[persistent_connection]
# Configuration pour les connexions persistantes (réseau, etc.)
connect_timeout = 30
connect_retry_timeout = 15
connect_interval = 1

[selinux]
# Configuration SELinux pour les environnements sécurisés
special_context_filesystems = fuse,nfs,vboxsf,ramfs,9p,vfat

[colors]
# Configuration des couleurs pour l'output console
highlight = white
verbose = blue
warn = bright purple
error = red
debug = dark gray
deprecate = purple
skip = cyan
unreachable = red
ok = green
changed = yellow
diff_add = green
diff_remove = red
diff_lines = cyan

[diff]
# Configuration des différences
always = True
context = 3

# Configuration spécifique SHA-Toolbox
[sha_toolbox]
# Intégration avec les outils SHA-Toolbox
toolbox_path = /apps/toolboxes
toolbox_version_file = /apps/toolboxes/version
toolbox_config_path = /apps/toolboxes/config
enable_toolbox_integration = True

# Chemins spécifiques aux environnements
applis_base_path = /applis
apps_base_path = /apps
etc_local_path = /etc/local

# Conformité BP21
enforce_vg_apps = True
forbid_rootvg_appli = True
require_etc_local_links = True

# Reporting et audit
enable_detailed_reporting = True
report_output_dir = /tmp/ansible_reports
include_version_info = True
include_performance_metrics = True

[inventory]
# Configuration de l'inventaire dynamique
enable_plugins = ini, yaml, constructed, host_list, script, auto, advanced_host_list
cache = True
cache_plugin = memory
cache_timeout = 3600
cache_connection = /tmp/ansible_inventory_cache

[privilege_escalation]
# Configuration de l'élévation de privilèges
become = True
become_method = sudo
become_user = root
become_exe = sudo
become_flags = -H -S -n

# Spécifique AIX (si applicable)
[aix]
become_method = su
become_user = root

# Spécifique Windows
[windows]
become_method = runas
become_user = SYSTEM