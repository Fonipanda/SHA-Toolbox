
PLAY [Application Environment Builder] *****************************************

TASK [Gathering Facts] *********************************************************
ok: [s02vl9938814]

TASK [Validation des variables obligatoires du Survey AAP2] ********************
ok: [s02vl9938814] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Création du répertoire de rapports] **************************************
changed: [s02vl9938814]

TASK [Initialisation du rapport d'exécution] ***********************************
changed: [s02vl9938814]

TASK [01 - Mise à jour Facts - Collecte des facts système étendus] *************

TASK [app_environment_builder : Collecte des facts système étendus] ************
ok: [s02vl9938814]

TASK [app_environment_builder : Version RHEL détaillée] ************************
ok: [s02vl9938814]

TASK [app_environment_builder : Informations sur les partitions] ***************
ok: [s02vl9938814]

TASK [app_environment_builder : Services systemd actifs] ***********************
ok: [s02vl9938814]

TASK [app_environment_builder : Packages installés critiques] ******************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification de l'espace disque] ***************
ok: [s02vl9938814]

TASK [app_environment_builder : Consolidation des informations OS détectées] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Affichage des informations OS détectées] *******
ok: [s02vl9938814] => {
    "detected_os_info": {
        "architecture": "x86_64",
        "cpu_cores": 2,
        "distribution": "RedHat",
        "family": "RedHat",
        "fqdn": "s02vl9938814.fr.net.intra",
        "hostname": "s02vl9938814",
        "kernel": "5.14.0-427.88.1.el9_4.x86_64",
        "memory_mb": 3659,
        "specific_info": {
            "aix_kernel": "N/A",
            "aix_oslevel": "N/A",
            "aix_volume_groups": [],
            "linux_packages": [],
            "linux_services": [
                "  UNIT                                                      LOAD   ACTIVE SUB     DESCRIPTION",
                "  atd.service                                               loaded active running Deferred execution scheduler",
                "  autofs.service                                            loaded active running Automounts filesystems on demand",
                "  besclient.service                                         loaded active running BESClient daemon",
                "  chronyd.service                                           loaded active running NTP client/server",
                "  crond.service                                             loaded active running Command Scheduler",
                "  dbus-broker.service                                       loaded active running D-Bus System Message Bus",
                "  dracut-shutdown.service                                   loaded active exited  Restore /run/initramfs on shutdown",
                "  elastic-agent.service                                     loaded active running Elastic Agent is a unified agent to observe, monitor and protect your system.",
                "  eTAC.service                                              loaded active running eTAC service",
                "  filebeat-cybersoc.service                                 loaded active running Filebeat service that send events to Databus",
                "  getty@tty1.service                                        loaded active running Getty on tty1",
                "  illumio-ven.service                                       loaded active exited  Illumio VEN Agent top level startup",
                "  import-state.service                                      loaded active exited  Import network configuration from initramfs",
                "  irqbalance.service                                        loaded active running irqbalance daemon",
                "  kdump.service                                             loaded active exited  Crash recovery kernel arming",
                "  kmod-static-nodes.service                                 loaded active exited  Create List of Static Device Nodes",
                "  lpar2rrd-agent.service                                    loaded active exited  Refresh system UUID for LPAR2RRD agent after a reboot",
                "  lvm2-monitor.service                                      loaded active exited  Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling",
                "  mcafee.ma.service                                         loaded active running Trellix Agent"
            ],
            "rhel_version": "Red Hat Enterprise Linux release 9.4 (Plow)",
            "windows_programs": [],
            "windows_services": [],
            "windows_version": "N/A"
        },
        "version": "9.4"
    }
}

TASK [app_environment_builder : Enregistrement des facts OS pour les autres rôles] ***
ok: [s02vl9938814]

TASK [Détection du middleware installé (AVANT création arborescence)] **********

TASK [app_environment_builder : Initialisation de la liste des middlewares et services détectés] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Copie du script de détection WebSphere] ********
changed: [s02vl9938814]

TASK [app_environment_builder : Exécution du script de détection WebSphere] ****
ok: [s02vl9938814]

TASK [app_environment_builder : Enregistrement du produit WebSphere détecté] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Affichage du produit WebSphere détecté par script Python] ***
ok: [s02vl9938814] => {
    "msg": "Produit WebSphere détecté via script: Liberty"
}

TASK [app_environment_builder : Vérification des répertoires WAS WASND] ********
ok: [s02vl9938814] => (item=/opt/IBM/WebSphere/AppServer)
ok: [s02vl9938814] => (item=/usr/IBM/WebSphere/AppServer)

TASK [app_environment_builder : Vérification processus WAS] ********************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification WAS Base (sans ND)] ***************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification des répertoires Liberty] **********
ok: [s02vl9938814] => (item=/opt/IBM/WebSphere/Liberty)
ok: [s02vl9938814] => (item=/usr/IBM/WebSphere/Liberty)
ok: [s02vl9938814] => (item=/opt/wlp)

TASK [app_environment_builder : Vérification processus Liberty] ****************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification du fichier oratab] ****************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification du processus Oracle PMON] *********
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification du répertoire Oracle ORACLE_HOME] ***
ok: [s02vl9938814] => (item=/u01/app/oracle/product)
ok: [s02vl9938814] => (item=/opt/oracle/product)

TASK [app_environment_builder : Vérification service SQL Server] ***************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification répertoire SQL Server] ************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification des répertoires MQ] ***************
ok: [s02vl9938814] => (item=/opt/mqm)
ok: [s02vl9938814] => (item=/usr/mqm)

TASK [app_environment_builder : Vérification du processus MQ] ******************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification des répertoires CFT] **************
ok: [s02vl9938814] => (item=/opt/axway)
ok: [s02vl9938814] => (item=/opt/cft)

TASK [app_environment_builder : Vérification du processus CFT] *****************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification des répertoires IHS] **************
ok: [s02vl9938814] => (item=/opt/IBM/HTTPServer)
ok: [s02vl9938814] => (item=/usr/IBM/HTTPServer)

TASK [app_environment_builder : Vérification processus IHS] ********************
ok: [s02vl9938814]

TASK [app_environment_builder : Vérification Java installé] ********************
ok: [s02vl9938814]

TASK [app_environment_builder : Ajout JVM à la liste des MIDDLEWARES] **********
ok: [s02vl9938814]

TASK [app_environment_builder : Récupération de la liste COMPLÈTE des services actifs] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Affichage debug services bruts] ****************
ok: [s02vl9938814] => {
    "msg": "Services actifs bruts détectés : 100"
}

TASK [app_environment_builder : Détection services - Synchronisation et Temps] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Connexion et Sécurité] ****
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Journalisation] ***********
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Planification de Tâches] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Agents et Supervision] ****
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Sauvegarde et Gestion des Données] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Sécurité et Protection] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Réseau] *******************
ok: [s02vl9938814]

TASK [app_environment_builder : Détection services - Système] ******************
ok: [s02vl9938814]

TASK [app_environment_builder : Consolidation de tous les services détectés] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Consolidation finale des middlewares et services détectés] ***
ok: [s02vl9938814]

TASK [app_environment_builder : Affichage du résumé de détection COMPLET PAR CATÉGORIES] ***
ok: [s02vl9938814] => {
    "msg": [
        "",
        "╔═══════════════════════════════════════════════════════════════════╗",
        "║  DÉTECTION MIDDLEWARES ET SERVICES - VERSION CATÉGORISÉE          ║",
        "╚═══════════════════════════════════════════════════════════════════╝",
        "",
        "🖥️  Serveur: s02vl9938814",
        "🐧 OS: RedHat 9.4",
        "",
        "═══════════════════════════════════════════════════════════════════",
        "📦 MIDDLEWARES DÉTECTÉS (1)",
        "═══════════════════════════════════════════════════════════════════"
    ]
}

TASK [app_environment_builder : Affichage détail middlewares] ******************
ok: [s02vl9938814] => (item={'name': 'JVM', 'type': 'runtime', 'path': 'N/A', 'version': 'java version "1.8.0_451"', 'status': 'installed'}) => {
    "msg": [
        "  1. JVM (runtime)",
        "     Chemin: N/A",
        "     Version: java version \\"1.8.0_451\\"",
        "     Processus actifs: 0"
    ]
}

TASK [app_environment_builder : Affichage en-tête services] ********************
ok: [s02vl9938814] => {
    "msg": [
        "",
        "═══════════════════════════════════════════════════════════════════",
        "🔧 SERVICES SYSTÈME DÉTECTÉS (16)",
        "═══════════════════════════════════════════════════════════════════",
        ""
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Synchronisation et Temps] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Synchronisation et Temps (1):",
        "  - chronyd: NTP Time Synchronization"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Connexion et Sécurité] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Connexion et Sécurité (2):",
        "  - sshd: SSH Daemon  - sssd: System Security Services"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Journalisation] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Journalisation (2):",
        "  - rsyslog: System Logging  - filebeat: Elastic Filebeat"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Planification de Tâches] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Planification de Tâches (2):",
        "  - crond: Cron Daemon  - atd: AT Daemon"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Agents et Supervision] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Agents et Supervision (4):",
        "  - elastic-agent: Elastic Agent  - dynatrace: Dynatrace OneAgent  - oneagent: Dynatrace OneAgent  - lvm2-monitor: LVM2 Monitoring"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Sécurité et Protection] ***
ok: [s02vl9938814] => {
    "msg": [
        "▶ Sécurité et Protection (3):",
        "  - mcafee: McAfee Antivirus  - eTAC: eTAC Service  - illumio-ven: Illumio VEN"
    ]
}

TASK [app_environment_builder : Affichage services par catégorie - Réseau] *****
ok: [s02vl9938814] => {
    "msg": [
        "▶ Réseau (2):",
        "  - snmpd: SNMP Daemon  - NetworkManager: Network Manager"
    ]
}

TASK [app_environment_builder : Affichage résumé final] ************************
ok: [s02vl9938814] => {
    "msg": [
        "",
        "═══════════════════════════════════════════════════════════════════",
        "📊 RÉSUMÉ",
        "═══════════════════════════════════════════════════════════════════",
        "Total Middlewares: 1",
        "Total Services: 16",
        "Total Composants: 17",
        "",
        "🔨 Middlewares à installer/configurer: 1",
        "   jvm",
        "",
        "👥 Utilisateurs techniques à créer: 0",
        "   Aucun",
        "",
        "✅ Détection terminée avec succès",
        "═══════════════════════════════════════════════════════════════════",
        ""
    ]
}

TASK [app_environment_builder : Enregistrement des facts pour les autres rôles] ***
ok: [s02vl9938814]

TASK [02 - Banner - Création bannière login] ***********************************

TASK [ips_toolbox_banner : Initialisation du rôle banner] **********************
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Récupération du Serial Number via dmidecode] ********
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Enregistrement du Serial Number] ********************
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Création d'un prompt shell simple et propre (chargé en dernier)] ***
changed: [s02vl9938814]

TASK [ips_toolbox_banner : Recherche et suppression des PS1 avec codes ANSI dans /etc/bashrc] ***
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Recherche et suppression des PS1 avec codes ANSI dans /etc/profile] ***
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Recherche des fichiers profile.d contenant codes ANSI] ***
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Création de la bannière PRÉ-LOGIN pour issue (console locale)] ***
changed: [s02vl9938814]

TASK [ips_toolbox_banner : Création de la bannière PRÉ-LOGIN pour issue.net (SSH)] ***
changed: [s02vl9938814]

TASK [ips_toolbox_banner : Création de la bannière POST-LOGIN (MOTD)] **********
changed: [s02vl9938814]

TASK [ips_toolbox_banner : Configuration SSH pour afficher la bannière PRÉ-LOGIN] ***
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Désactivation de PrintLastLog dans SSH (Last login géré par PAM)] ***
ok: [s02vl9938814]

TASK [ips_toolbox_banner : Affichage du statut de création des bannières] ******
ok: [s02vl9938814] => {
    "msg": [
        "✅ Bannières créées pour s02vl9938814",
        "   • PRÉ-LOGIN (/etc/issue.net): Disclaimer uniquement",
        "   • POST-LOGIN (/etc/motd): Informations système complètes",
        "   • PROMPT: Nettoyé et simplifié ($ sans codes ANSI)",
        "Type: RedHat 9.4",
        "Virtualisation: kvm",
        "Serial Number: Not Specified",
        "Application: 12402",
        "Middlewares: {'name': 'JVM', 'type': 'runtime', 'path': 'N/A', 'version': 'java version \\"1.8.0_451\\"', 'status': 'installed'}"
    ]
}

TASK [03 - Users - Création d'utilisateurs techniques] *************************

TASK [ips_toolbox_users : Initialisation du rôle users] ************************
ok: [s02vl9938814]

TASK [ips_toolbox_users : Récupération des middlewares réellement détectés] ****
ok: [s02vl9938814]

TASK [ips_toolbox_users : Affichage des middlewares détectés AVANT création users] ***
fatal: [s02vl9938814]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'item' is undefined. 'item' is undefined\\n\\nThe error appears to be in '/runner/project/roles/ips_toolbox_users/tasks/main.yml': line 13, column 3, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n\\n- name: \\"Affichage des middlewares détectés AVANT création users\\"\\n  ^ here\\n"}

TASK [Gestion des erreurs du workflow] *****************************************
ok: [s02vl9938814] => {
    "msg": [
        "Une erreur s'est produite lors de l'exécution du workflow",
        "Consultez les logs dans /tmp/ansible_reports"
    ]
}

TASK [Création du répertoire de rapports si nécessaire] ************************
ok: [s02vl9938814]

TASK [14 - Génération du récapitulatif final d'exécution] **********************

TASK [report_generator : Collecte de tous les résultats d'exécution] ***********
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Toolbox] ***********************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Dynatrace] *********************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Illumio] ***********************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats TSM/Backup] ********************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Uptime] ************************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Filesystems] *******************
ok: [s02vl9938814]

TASK [report_generator : Collecte des résultats Utilisateurs] ******************
ok: [s02vl9938814]

TASK [report_generator : Affichage du récapitulatif final complet] *************
ok: [s02vl9938814] => {
    "msg": [
        "",
        "╔════════════════════════════════════════════════════════════════════════╗",
        "║        RÉCAPITULATIF COMPLET D'EXÉCUTION - CREATE SOCLE - AAP2         ║",
        "╚════════════════════════════════════════════════════════════════════════╝",
        "",
        "┌─ INFORMATIONS GÉNÉRALES ────────────────────────────────────────────┐",
        "│ Date d'exécution : 2025-10-28T14:16:14Z",
        "│ Serveur          : s02vl9938814 (s02vl9938814.fr.net.intra)",
        "│ OS               : RedHat 9.4",
        "│ Kernel           : 5.14.0-427.88.1.el9_4.x86_64",
        "│ Architecture     : x86_64",
        "│ Code Application : 12402",
        "│ Code 5 car       : acfrb",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "┌─ MIDDLEWARES ET SERVICES DÉTECTÉS ──────────────────────────────────┐",
        "│",
        "│ 🔵 MIDDLEWARES D'APPLICATIONS (1)",
        "│    JVM",
        "│",
        "│ 🟢 SERVICES SYSTÈME PAR CATÉGORIE (16)",
        "│    • Synchronisation: chronyd",
        "│    • Sécurité: sshd, sssd, mcafee, eTAC",
        "│    • Journalisation: rsyslog, filebeat",
        "│    • Planification: crond, atd",
        "│    • Supervision: elastic-agent, lvm2-monitor",
        "│    • Réseau: snmpd, NetworkManager",
        "│",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "┌─ AGENTS DE SUPERVISION ─────────────────────────────────────────────┐",
        "│",
        "│ 📊 DYNATRACE ONEAGENT",
        "│    • Installé           : ❌ NON",
        "│    • Version            : N/A",
        "│    • Statut             : Non vérifié",
        "│    • Mode surveillance  : N/A",
        "│",
        "│ 🛡️ ILLUMIO VEN",
        "│    • Installé           : ❌ NON",
        "│    • Version            : N/A",
        "│    • Statut VEN         : N/A",
        "│    • Mode Enforcement   : enforced",
        "│    • Connectivité PCE   : ⚠️ Non vérifié",
        "│",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "┌─ TOOLBOX IPS ───────────────────────────────────────────────────────┐",
        "│ Installée        : ❌ NON",
        "│ Version          : N/A",
        "│ Chemin           : /apps/toolboxes",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "┌─ INFRASTRUCTURE ────────────────────────────────────────────────────┐",
        "│",
        "│ 🗂️ FILESYSTEMS",
        "│    • FS créés/vérifiés  : 0/0",
        "│    • Arborescence       : /applis, /apps, /applis/logs, /applis/delivery",
        "│",
        "│ 👥 UTILISATEURS TECHNIQUES",
        "│    • Oracle (oracle)    : non vérifié",
        "│    • WebSphere (wasadmin): non vérifié",
        "│    • Liberty (liberty)  : non vérifié",
        "│    • CFT (cft)          : non vérifié",
        "│",
        "│ ⏰ UPTIME ET NTP",
        "│    • Uptime actuel      : N/A jours",
        "│    • Limite configurée  : 90 jours",
        "│    • Statut             : N/A",
        "│    • Service chronyd    : ✅ Actif",
        "│",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "┌─ SAUVEGARDE ────────────────────────────────────────────────────────┐",
        "│",
        "│ 💾 TSM BACKUP",
        "│    • Client installé    : ❌ NON",
        "│    • Chemin             : N/A",
        "│    • Version            : N/A",
        "│    • Service dsmcad     : Non vérifié",
        "│    • Script REAR        : ❌ Absent",
        "│",
        "└──────────────────────────────────────────────────────────────────────┘",
        "",
        "╔════════════════════════════════════════════════════════════════════════╗",
        "║                    ✅ EXÉCUTION TERMINÉE AVEC SUCCÈS                   ║",
        "╚════════════════════════════════════════════════════════════════════════╝",
        ""
    ]
}

TASK [report_generator : Sauvegarde du récapitulatif en JSON] ******************
changed: [s02vl9938814]

TASK [Finalisation du rapport d'exécution] *************************************
changed: [s02vl9938814]

PLAY RECAP *********************************************************************
s02vl9938814               : ok=89   changed=9    unreachable=0    failed=0    skipped=25   rescued=1    ignored=0   

