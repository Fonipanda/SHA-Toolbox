---
- name: "Initialisation du rôle ips_toolbox_illumio (variables complètement statiques)"
  ansible.builtin.set_fact:
    illumio_component: "illumio"
    illumio_role_name: "ips_toolbox_illumio"
    illumio_operation_final: "configure"  # TOUJOURS configure - jamais de condition

- name: "Construction du nom de fichier de tâche Illumio (statique fixe)"
  ansible.builtin.set_fact:
    illumio_task_file_name: "configure_Linux_illumio.yml"  # FICHIER FIXE - pas de variable

- name: "Vérification de l'existence de la tâche Illumio (fichier fixe)"
  ansible.builtin.stat:
    path: "{{ role_path }}/tasks/configure_Linux_illumio.yml"  # CHEMIN FIXE
  register: illumio_task_file_check
  delegate_to: localhost

- name: "Exécution de la tâche Illumio configure_Linux_illumio.yml"
  block:
    - name: "Inclusion directe du fichier configure_Linux_illumio.yml"
      ansible.builtin.include_tasks: configure_Linux_illumio.yml  # FICHIER FIXE
      when: illumio_task_file_check.stat.exists
  rescue:
    - name: "Gestion de l'erreur - Fichier configure_Linux_illumio.yml introuvable"
      ansible.builtin.include_role:
        name: ips_toolbox_set_results
      vars:
        set_results_state: "KO"
        set_results_component: "illumio"  # STATIQUE
        set_results_operation: "configure"  # STATIQUE
        set_results_value: "Fichier configure_Linux_illumio.yml introuvable"  # STATIQUE
      ignore_errors: true

- name: "Affichage du statut d'exécution Illumio (variables statiques)"
  ansible.builtin.debug:
    msg:
      - "Rôle Illumio traité avec fichier fixe"
      - "Fichier: configure_Linux_illumio.yml"
      - "Opération: configure"
      - "Statut: {{ 'SUCCÈS' if illumio_task_file_check.stat.exists else 'FICHIER INTROUVABLE' }}"
