---

- name: Obtain information about a registry key property
  win_reg_stat:
    path: HKLM:\SOFTWARE\Toolboxes
    name: Version
  ignore_errors: yes
  register: toolboxes_version

- name: Format to Json when toolbox is installed
  set_fact:
    tmp_json: "{ \"installed\": \"yes\" ,\"version\": \"{{ toolboxes_version.value }}\" }"
  when: toolboxes_version.exists == true 

- name: Format to Json when toolbox is not installed
  set_fact:
    tmp_json: "{ \"installed\": \"no\" ,\"version\": \"\" }"
  when: toolboxes_version.exists == false

- name: format installation state
  include_role:
    name: ips_toolbox_set_results
  vars:
    set_results_state: "info"
    set_results_item: ""
    set_results_value: "{{ tmp_json | to_json | from_json }}"
    set_results_component: "{{ toolboxes_component }}"
    set_results_operation: "{{ toolboxes_operation }}"
    set_results_role_name: "{{ toolboxes_role_name }}"
    set_results_result_name: "{{ toolboxes_result_name }}"
    set_results_status:
      "{% if toolboxes_version.failed != true %}\

        OK\

       {% else %}\

        KO\

       {% endif %}"

